## 第二章节：背景知识

提供了关于NTP和NTP池的技术背景知识，解释了NTP的工作原理、NTP池的架构和监控机制，以及时间同步在各种关键系统中的重要性。

### 2.1 NTP的工作原理

NTP是用于计算机网络时间同步的协议，确保网络中的所有设备可以保持精确一致的时间。NTP通过从参考时间源（如原子钟或GPS）获取时间，然后在网络中分发这些时间信息，实现时间同步。

1. **层级结构（Stratum Levels）**：
    - **Stratum 0**：这些设备是直接提供时间的设备，例如原子钟、GPS接收器。
    - **Stratum 1**：这些服务器直接连接到Stratum 0设备，通过低延迟链接提供时间。
    - **Stratum 2及以下**：这些服务器从上一级的NTP服务器获取时间，逐级分发。
2. **时间同步机制**：
    - NTP使用UDP协议在网络中传输时间信息，通过时间戳和延迟计算实现时间同步。
    - 时间同步过程中，NTP客户端从**多个NTP服务器获取时间，通过算法选择最可靠的时间源进行校准**。

### 2.2 NTP池的架构

NTP池是一个大型的、分布式的NTP服务器集合，由全球范围内的志愿者维护。其目的是通过分散负载，提供高可用性和可靠性的时间同步服务。

1. **池的组织方式**：
    - NTP池通过地域和时间服务器的层级组织，确保每个地理区域都有足够的时间服务器。
    - 每个NTP客户端在请求时间时，会从池中**随机选择多个时间服务器**，分散负载，避免单点故障。
2. **池的监控机制**：
    - NTP池通过一套监控系统定期检查时间服务器的健康状态，包括响应时间、时间精度和可用性。
    - 监控系统根据时间服务器的表现给其评分，并**将低评分或不可靠的服务器移出池**。

### 2.3 时间同步的重要性

时间同步在各种关键系统中至关重要，包括金融系统、通信网络、数据中心和各种基础设施。

1. **金融系统**：
    - 精确的时间同步确保交易的准确性和顺序性，防止交易欺诈和数据篡改。
2. **通信网络**：
    - 时间同步确保数据包的正确顺序和时间戳，提高网络传输的可靠性和效率。
3. **数据中心和服务器**：
    - 时间同步确保日志记录的一致性和准确性，便于故障排查和系统维护。

## 第三章节：攻击模型

详细描述了假设的攻击模型，包括攻击者的目标、对手模型、攻击策略和实现方法。分析了攻击者如何通过控制部分时间服务器，利用延迟攻击来微调目标区域的时间偏移。

### 3.1 攻击者目标

攻击者的主要目标是利用NTP池系统来大规模改变NTP客户端的本地时间，

特别是在一个特定的地理区域内，例如一个国家或整个大陆。这种时间偏移可以逐步扰乱依赖精确时间同步的关键基础设施，如金融系统或医疗操作。

### 3.2 对手模型

在攻击模型中，假设NTP池管理和监控服务器基础设施是善意且受信任的。对手的能力假设如下：

1. **控制部分时间服务器**：
    - 攻击者可以通过入侵现有的NTP时间服务器，或**将其控制的恶意服务器加入NTP池**中。
2. **区分客户端与监控服务器**：
    - 攻击者的服务器能够区分常规NTP客户端和NTP池的监控服务器。对监控服务器，攻击者报告准确的时间；
    - 对普通NTP客户端，则报告不准确的时间，从而绕过监控系统的检查，确保其恶意服务器存活。

### 3.3 攻击策略

攻击策略包括以下几个步骤：

1. **识别监控服务器**：
    - 通过分析NTP请求模式，攻击者可以识别出哪些请求来自NTP池的监控服务器。
2. **微控制时间偏移**：
    - 攻击者利用延迟攻击来逐步微调目标服务器的时间偏移。通过对监控日志的连续分析，攻击者可以推断前一次的延迟并反馈当前的延迟，从而在动态网络环境下微调攻击配置，达到500毫秒的不对称延迟目标。
3. **隐蔽攻击**：
    - 在攻击过程中，攻击者需确保其操作隐蔽，不被NTP池的管理和监控系统发现。通过对监控服务器报告准确的时间，攻击者的服务器可以避免被移出NTP池，从而继续对普通NTP客户端报告不准确的时间。

### 3.4 攻击影响分析

分析了攻击者可能实现的多种效果：

1. **操纵目标服务器的时间偏移**：
    - 通过上述策略，攻击者能够成功地控制目标服务器的时间偏移，从而影响大范围内的NTP客户端。
2. **监控服务器合理性检查的有效性**：
    - 监控服务器能否继续执行合理性检查和监控任务，以及其对目标时间服务器评分的准确性。
3. **攻击者的隐蔽性**：
    - 攻击者能否在攻击期间及之后保持低调，不被NTP管理员发现，确保其恶意服务器长时间存活于NTP池中。

### 时间偏移

### 1. 延迟攻击机制

延迟攻击的关键在于操纵时间戳，使得从攻击者控制的服务器到客户端的往返延迟（RTT）不对称。具体方法包括：

1. **引入固定延迟**：
    - 在向普通NTP客户端回复时间信息时，攻击者引入固定延迟，使得客户端的本地时间逐步偏移。
2. **动态调整延迟**：
    - 攻击者可以根据监控服务器的反馈动态调整延迟时间。通过持续监控和分析日志，攻击者可以逐步微调延迟，以达到目标时间偏移。

### 2. 微调时间偏移的具体方法

为了实现精确的时间偏移控制，攻击者需要采用以下方法：

1. **反馈机制**：
    - 攻击者对监控日志进行连续分析，推断出前一次延迟攻击的效果，并基于此反馈调整当前的延迟配置。
2. **分阶段实施**：
    - 时间偏移的调整应分阶段进行，每次调整的幅度应足够小，以避免被监控系统检测到异常。通过多次小幅度的调整，逐步实现较大的时间偏移。
3. **模拟正常网络波动**：
    - 攻击者可以通过模拟正常的网络延迟波动，使延迟调整看起来像是网络环境中的正常变化，从而掩盖攻击行为。

### NTP协议的时间同步机制

NTP协议通过网络传输时间信息，确保客户端与服务器之间的时间同步。基本同步过程如下：

1. **时间戳交换**：
    - NTP客户端向NTP服务器发送请求，并记录发送时间（T1）。
    - 服务器接收到请求后，记录接收时间（T2），然后将服务器的当前时间（T3）发送回客户端。
    - 客户端接收到回复后，记录接收时间（T4）。
2. **往返延迟（RTT）和时间偏移计算**：
    - 往返延迟：RTT = (T4 - T1) - (T3 - T2)
    - 时间偏移：Offset = ((T2 - T1) + (T3 - T4)) / 2

通过这些计算，客户端可以调整其本地时钟，使之与服务器时钟同步。

### 引入延迟如何影响时间同步

当攻击者引入延迟时，会影响上述时间戳和计算，具体如下：

1. **固定延迟**：
    - 如果攻击者在向客户端发送时间信息时引入固定延迟，客户端会误以为从服务器到客户端的时间戳（T3到T4）比实际情况长。
    - 这会导致客户端计算的往返延迟（RTT）和时间偏移（Offset）出现偏差，进而调整其本地时间，使之逐步与服务器时间不同步。
2. **不对称延迟**：
    - 攻击者可以通过引入不对称延迟（即只在一方向上引入延迟）来进一步精确控制时间偏移。
    - 例如，攻击者在从服务器到客户端的路径上引入延迟，但在从客户端到服务器的路径上保持正常。这会导致客户端误以为其本地时间慢于服务器时间，从而不断加快其本地时钟。

### 时间逐步偏移的过程

由于NTP客户端通常会定期从多个NTP服务器获取时间并调整本地时钟，如果攻击者持续引入小幅延迟，客户端的本地时间会逐步累积偏移：

1. **连续微调**：
    - 攻击者可以每次引入很小的延迟，使时间偏移幅度足够小，以避免被检测到。
    - 通过连续多次的小幅调整，客户端的时间偏移会逐步累积成显著偏差。
2. **隐蔽性**：
    - 小幅度的时间偏移不会立即引起监控系统的警觉。攻击者通过分阶段引入延迟，使偏移过程看起来像正常的网络波动。

## 第四章节：攻击策略

具体描述了攻击者的攻击策略和步骤，包括如何识别并绕过监控服务器，确保其控制的服务器能通过监控和检查系统。介绍了攻击者如何通过对监控日志的分析和反馈机制实现不对称延迟目标。

### 4.1 识别监控服务器

攻击者需要首先识别出NTP池的监控服务器，以便在这些服务器上报告准确的时间，而对普通NTP客户端报告不准确的时间。识别监控服务器的方法包括：

1. **分析请求模式**：
    - 监控服务器通常会以规律的间隔发送请求，且这些请求来自特定的IP地址范围。攻击者可以通过分析NTP请求的频率和来源，识别出这些监控服务器。
2. **探测反应**：
    - 通过向不同IP地址发送测试请求，并观察其响应时间和模式，攻击者可以进一步确认哪些IP地址属于监控服务器。

### 4.2 微控制时间偏移

在识别监控服务器后，攻击者可以开始实施微控制时间偏移的策略：

1. **引入延迟**：
    - 在向普通NTP客户端发送时间信息时，攻击者引入固定或动态的延迟，使客户端的本地时间逐步偏移。延迟的大小需要足够小，以避免引起监控系统的警觉。
2. **动态调整延迟**：
    - 通过分析监控日志，攻击者可以了解前一次延迟的效果，并据此动态调整当前的延迟配置。这样可以确保时间偏移的逐步积累，同时保持攻击的隐蔽性。

### 4.3 混淆策略

为了避免被监控系统发现，攻击者可以采用混淆策略，使其操作看起来像是正常的网络波动：

1. **模拟正常网络延迟**：
    - 攻击者可以**在正常网络延迟的基础上进行微调**，使延迟变化看起来更自然。例如，通过引入随机的、小幅度的延迟变化，攻击者可以掩盖其恶意操作。
2. **分阶段实施攻击**：
    - 攻击应分阶段进行，每次调整的幅度足够小，并在不同时间段内实施，以避免监控系统检测到显著的时间偏移。

### 4.4 维持攻击效果

为了保持攻击的持续性和有效性，攻击者需要采取措施确保其控制的时间服务器长时间存活于NTP池中：

1. **对监控服务器报告准确时间**：
    - 攻击者控制的服务器在响应监控服务器请求时，应报告准确的时间，以通过监控系统的检查。
2. **持续监控和调整**：
    - 攻击者需要持续监控NTP池的状态，并根据监控日志和反馈信息，**动态调整其攻击策略，确保时间偏移的累积效果**。

## 第五章节：攻击影响分析

分析了攻击的潜在影响，包括攻击者成功操纵目标服务器时间偏移的可能性、监控服务器执行合理性检查的有效性，以及攻击者在攻击期间和之后保持低调的能力。

### 5.1 时间偏移的累积效果

攻击者通过逐步引入延迟，使目标NTP客户端的本地时间逐步偏移。该过程的累积效果可能导致显著的时间误差：

1. **时间偏移范围**：
    - 攻击者可以在长时间内逐步累积时间偏移，使目标区域的NTP客户端时间偏差达到几秒甚至几分钟，从而影响依赖精确时间同步的系统和应用。
2. **关键系统的影响**：
    - 例如，金融系统中依赖时间戳进行交易记录，如果时间偏差过大，可能导致交易顺序错误或时间冲突，进而引发金融欺诈或系统故障。
    - 在通信网络中，时间偏差会影响数据包的传输顺序和时序分析，导致网络性能下降或数据丢失。

### 5.2 对监控服务器合理性检查的影响

攻击者的操作可能削弱监控服务器的合理性检查功能：

1. **监控准确性下降**：
    - 由于攻击者在监控服务器请求时报告准确时间，监控服务器难以检测出其真实的时间偏移。这导致监控系统的评分和健康检查结果失真，无法有效移除恶意服务器。
2. **系统信任度下降**：
    - 随着更多恶意服务器进入NTP池，系统整体的信任度和可靠性下降，增加了时间同步服务被滥用或攻击的风险。

### 5.3 影响的范围和隐蔽性

分析攻击者在攻击期间和之后保持低调的能力及其影响范围：

1. **隐蔽攻击**：
    - 通过小幅度、多次调整时间偏移，攻击者能够在不被监控系统察觉的情况下实现显著的时间偏差。这种隐蔽性使攻击持续时间更长，影响更广泛。
2. **地理范围的影响**：
    - 攻击者可以选择特定的地理区域实施攻击，影响该区域内所有使用NTP池进行时间同步的客户端，从而在特定地区引发广泛的时间同步问题。
3. **长远影响**：
    - 长时间的时间偏移可能导致长期的数据记录和分析错误，影响历史数据的准确性和可靠性。

### 总结

第五章节通过对时间偏移累积效果、监控服务器合理性检查的影响、攻击范围和隐蔽性的分析，展示了攻击者如何利用NTP池系统的脆弱性对时间同步产生深远的负面影响。这为理解NTP池系统的安全风险及其防御措施的重要性提供了理论依据。

## 第六章节：防御机制

提出了多种防御措施，包括在监控服务器中嵌入可信参考时钟、引入监控异常检测的启发式方法、提高监控服务器的责任，以及使用匿名通信系统和随机调度监控过程以增加攻击者预测难度。

### 6.1 加强监控服务器的检测能力

为了提升监控服务器对恶意行为的检测能力，可以采取以下措施：

1. **多维度监控**：
    - 通过增加监控的维度，例如监控服务器的地理分布和多样化的请求模式，可以提高恶意服务器的识别率。
2. **异常行为分析**：
    - 采用机器学习和大数据分析技术，对NTP服务器的响应时间和时间偏移进行异常检测。任何偏离正常范围的行为都会触发进一步的调查。
3. **定期更新监控策略**：
    - 随着攻击技术的不断演进，监控策略需要定期更新，以应对新的威胁。通过定期审查和更新，保持监控系统的有效性。

### 6.2 增强时间同步的安全性

为了确保时间同步的准确性和可靠性，可以实施以下增强措施：

1. **多源时间验证**：
    - 客户端可以从多个独立的时间源获取时间信息，并对这些信息进行交叉验证。如果某个时间源的数据偏离其他源，客户端可以选择忽略该源。
2. **加密和认证**：
    - 通过使用加密和认证技术，确保时间数据在传输过程中不被篡改。NTP协议可以集成TLS（传输层安全协议）来提供安全保障。
3. **容错机制**：
    - 客户端可以实现容错机制，例如在检测到时间偏移异常时自动切换到备用时间源，或在必要时通知管理员进行人工干预。

### 6.3 提高NTP池的可靠性

为了提高NTP池系统的整体可靠性，可以实施以下策略：

1. **服务器多样化**：
    - 通过增加参与NTP池的服务器数量和多样性，减少单一服务器失效对系统的影响。地理位置和提供商的多样化有助于增强系统的鲁棒性。
2. **动态评分和调整**：
    - 实施动态评分系统，根据服务器的响应时间、准确性和可靠性进行实时评分，并根据评分动态调整服务器的参与程度和优先级。
3. **社区参与和反馈**：
    - 鼓励社区和用户反馈，通过开放的沟通渠道及时发现和解决问题。社区参与有助于提升系统的透明度和信任度。

### 6.4 实施防御性编程和测试

为了确保NTP池系统在设计和实现上具备防御能力，可以采取以下措施：

1. **安全编码实践**：
    - 在开发过程中遵循安全编码实践，避免常见的编程错误和漏洞。通过代码审查和静态分析工具，提前发现和修复潜在问题。
2. **渗透测试和模拟攻击**：
    - 定期进行渗透测试和模拟攻击，评估系统的安全性和防御能力。通过模拟真实攻击场景，发现系统的薄弱环节并进行改进。
3. **持续监控和改进**：
    - 实施持续监控机制，及时发现和响应安全事件。通过不断改进和优化，保持系统的高安全性和高可用性。

### 总结

第六章节提出了多种防御机制，从加强监控、增强安全性、提高可靠性到防御性编程和测试，全面提升NTP池系统的安全性和可靠性。这些措施旨在应对潜在的攻击威胁，确保时间同步服务的准确性和稳定性。

# 1 Introduction

NTP 池有一个监控系统，可以检查池中时间服务器的状态。它经常向时间服务器发送 NTP 挑战，并检查它们的时钟准确性和响应性。时间值不正确的时间服务器将被释放，并最终从池中移除。

# 2 Background: NTP Basics

### NTP客户端

客户端习惯于查询多个服务器-每个服务器多次查询-修剪异常值，并计算中位数偏移量以更新其时间

### NTP安全

NTP 容易受到 MITM攻击，其中通信路径上的恶意实体拦截并伪造 NTP数据包。这些漏洞加强了对 NTP身份验证的需求

NTP认证不能防止网络延迟攻击

# 3 Case Study: NTP Pool Ecosystem

## 3.1 NTP Pool Architecture

NTP 池是一组公共 NTP 时间服务器，用于 NTP 客户端同步。在可用性、可靠性和可扩展性方面，NTP 池系统利用 DNS，统一访问分布在全球的参与时间服务器

监视服务器，定期检查参与计时服务器的状态。集中式管理服务器监督监控服务器的操作，以保持整个池的一致视图。

**管理系统**

管理系统提供一个接口 参与者通过此接口注册 管理系统将参与者注册到附近最合适、错误最少的时间服务器

管理系统利用监控服务器来跟踪参与计时服务器的状态;将调度的作业列表传递给监控服务器，收集监控结果，并将不健康的时间服务器从池中移除。

**监控服务器**

负责检查池中时间服务器的运行状况，并计算时间服务器的时间偏移到监控服务器的本地时间(准确性)。

监控服务器将检查的结果报告给管理服务器：时间服务器ip 偏移量等

任何人可以查看时间NTP服务器的日志

## 3.2 Vulnerabilities at the Top of the Hierarchy

**时间测量循环依赖**

监控服务器在维持NTP池中时间服务器的准确性方面扮演了关键角色，但其时间准确性依赖于外部时间服务器，这种依赖关系存在循环依赖的风险。如果外部时间源传播不准确的时间，可能导致整个NTP池的时间同步体系崩溃

**单点故障弱**

一个单一的错误或被攻陷的监控器就能够对整个NTP池的状态检测产生严重影响。由于监控系统高度依赖于这些监控器的反馈信息，因此其脆弱性显得尤为突出

## 3.3 New Monitoring System under Pilot Test-ing and Limitations

NTP池在试验新的多监控服务器系统时，尽管增加了多个监控服务器，但评分逻辑和安全机制未见显著改进。

分布式监控服务器之间可能存在时间偏差，且目前的系统无法防止恶意监控服务器的伪造行为，需要进一步的安全措施来增强系统的可靠性和完整性。

### 评分机制

1. **健康检查**：监控服务器定期向时间服务器发送NTP请求，以检查其响应的准确性和稳定性。每次检查会记录响应的延迟和偏移量。
2. **评分逻辑**：根据时间服务器的响应，监控服务器给每个时间服务器一个分数。这些分数的计算通常基于以下几个因素：
    - **偏移量（Offset）**：这是时间服务器返回的时间与监控服务器本地时间之间的差异。偏移量越小，说明时间服务器越准确。
    - **延迟（Delay）**：这是NTP请求从监控服务器到时间服务器再返回的总时间。延迟越小，说明时间服务器响应越快。
    - **稳定性（Stability）**：时间服务器在多次检查中的表现是否一致。如果时间服务器的偏移量和延迟变化较大，评分会受到影响。
3. **评分范围**：每个时间服务器的评分通常在一个预定的范围内。例如，从-30到20分：
    - **高分**：表示时间服务器非常可靠和准确。
    - **低分**：表示时间服务器不可靠，可能被移出NTP池。
4. **评分计算**：具体的评分算法可能如下：
    - 初始分数：每个时间服务器的初始分数设置为一个默认值（例如10分）。
    - 偏移量调整：如果偏移量超出某个阈值，分数会被减少。例如，偏移量超过3.5毫秒，分数减少。
    - 延迟调整：如果延迟超过某个阈值，分数也会减少。例如，延迟超过1秒，分数减少。
    - 稳定性调整：如果时间服务器在多次检查中的偏移量和延迟变化较大，分数也会被减少。
5. **处理异常情况**：监控服务器还会处理一些异常情况，例如时间服务器完全无响应，或响应时间过长。这些情况通常会导致分数大幅减少，甚至直接将时间服务器标记为不可靠并从NTP池中移除。

# 4 Attack Modeling

### 攻击模型

- **假设前提**：假定NTP池的管理和监控服务器基础设施是良性的
- **攻击控制范围**：攻击者控制目标区域的一部分时间服务器。被对手控制的时间服务器能够区分普通NTP客户端和NTP池的监控服务器
- **攻击行为**：恶意时间服务器会向监控服务器报告准确的时钟读数，而向NTP客户端提供不正确的时间值。
- **网络攻击**：攻击者还可以进行路径攻击，修改或注入未认证连接中的数据包，或在认证连接中延迟或丢弃数据包。此外，网络攻击可以结合BGP前缀劫持，从多个角度进行攻击。

### 攻击策略

- **挑战与应对**：
    - Chronos和Ananke等机制允许NTP客户端从随机抽样的多个NTP时间服务器收集时间信息，移除离群值，并计算出看似准确的时间，从而提高对时间偏移攻击的抵抗力。
    - 攻击成功需要大量恶意时间服务器以占据NTP客户端查询列表的大部分，篡改大部分响应数据包，或通过DNS缓存中毒吸引客户端访问恶意时间服务器。
- **实用困难**：
    - 要影响目标区域或整个池，需要感染或注入数百甚至数千个时间服务器。
    - 如果响应数据包经过认证，数据包篡改可以被阻止。
    - 虽然可以增加对手时间服务器被多个客户端查询的概率，但不能保证客户端的查询列表会充满对手的时间服务器。
- **攻击策略**：
    - **排优存劣**：攻击者的目标是使池中的合法时间服务器不可见，最大化恶意时间服务器的影响力。为此，攻击者利用池的监控系统。通过利用监控过程，攻击者可以将竞争（合法）的时间服务器排除出池，吸引更多NTP客户端查询攻击者的时间服务器。
    - 对手必须保持低调以避免被池管理员察觉。

### 攻击方法

- **干扰攻击**：通过网络攻击利用监控操作，最终影响检查结果。这种方法适用于当前由池管理的单一监控服务器系统。
- **侵入攻击**：针对当前正在测试的多监控服务器系统，对手直接操纵监控结果。

# 5 Interference Attacks

## 5.1 Adding Asymmetric Delays to Monitoring Packets

### 攻击概述

攻击者误导监控服务器 

### 延迟攻击

- **基本原理**：攻击者通过在NTP通信中添加非对称网络延迟实现目标。非对称延迟不会在当前互联网环境中显得异常，因为网络拥堵或路由路径不对称是常见现象，因此很难检测到此类攻击。
- **实施方法**：攻击者设定目标延迟为目标偏移量的两倍（target_delay = 2 * target_offset），例如，当目标偏移量为250毫秒时，目标延迟为500毫秒。这不会导致NTP失效，因为NTPv4对延迟攻击的最大容忍往返时间为一秒。

### BGP劫持

- **α 表示由于 BGP 劫持导致的额外网络延迟（取决于数据包在劫持路径中的额外路由延迟）** 具体来说，α 是响应包的单程延迟（OWD(Rep)）与请求包的单程延迟（OWD(Req)）之间的差值
- β 用于补偿网络中的实际延迟变化，确保攻击者能够精确控制总的网络延迟
- **实施细节**：为了有效地执行非对称延迟攻击，攻击者需要位于所有流量的集散点将所有流量转向自己。
    - 最确定的集散点是监控服务器之前的节点。通过伪造BGP公告，攻击者修改目标IP前缀的路由路径。这样，NTP请求包通过原始路径，而响应包经过攻击者，导致额外的非对称延迟。
- **变异**：根据攻击者位置的不同，额外的延迟也会不同。攻击者无法直接推断每个时间服务器的额外延迟α，因此需要生成另一个人工延迟β = target_delay - α。

### 自适应非对称延迟

- **数据收集**：攻击者首先收集被劫持时间服务器的地址，通过嗅探发送给监控服务器的NTP响应包。
- **延迟计算**：等待足够的时间（如一分钟），池系统更新时间服务器的新评分。攻击者获取这些时间服务器的日志记录，比较最新记录的偏移量与几小时前的记录，估算当前的延迟α。
- **调整延迟**：根据估算的α，计算需要添加的额外延迟β。攻击者在下一轮监控过程中向NTP响应包添加此额外延迟，逐步调整偏移量直到达到目标值。
    - **保证目标延迟不变**
        
        保证服务器响应时间在一定范围内 从而控制评分
        
        保持一个稳定的目标延迟 可以使服务器看起来正常但不准确 保持低调
        

## 5.2 Shifting the Monitoring Server’s Local Time

### 攻击概述

另一种有效方式是攻击监控服务器 让监控服务器以为池中正常的时间服务器都不正常

### DNS缓存投毒

攻击者针对监控服务器的DNS解析器

攻击者针对监控服务器的DNS解析器。通过冒充合法的域名服务器并向解析器注入伪造响应（或IP片段），攻击者可以使监控服务器的查询指向伪造的IP地址。以下是攻击步骤：

1. **伪装合法服务器**：攻击者伪装成合法的域名服务器，使用伪造的IP地址。
2. **注入伪造响应**：
    1. 当解析器向上游权威域名服务器发出查询时，攻击者注入伪造响应。
    2. 如果伪造响应先于合法响应到达
    解析器接受伪造响应，更新缓存，并将伪造IP地址回复给监控服务器。

# 6 Invasive Attack

注册恶意的监控服务器 并且可以绕过监控系统的检查 从而操作监控结果 少量的恶意监控服务器可以带来巨大的后果

### 1. 注册恶意监控服务器

攻击者可以通过专用管理URL注册新的监控服务器并参与测试。注册流程如下：

1. 下载并安装监控代理二进制文件。
2. 提供IP地址和电子邮件地址，管理员会发放API密钥和证书。

通过这一过程，攻击者可以轻松地在不同地区（如欧洲、美洲和亚洲）注册多个监控服务器。第7.3节将展示如何使用少量监控服务器进入监控系统并停用目标时间服务器。

### 2. 绕过自检

> 攻击者可以通过省略自检代码或绕过二进制文件轻松绕过自检，使其恶意服务器通过监控系统的合法性检查
> 

现行监控系统未考虑对监控服务器的完整性检查，监控服务器的合法性目前仅依赖于自检，具体步骤如下：

1. 监控服务器通过与外部公共时间服务器交换NTP数据包来自我估计本地时钟的准确性。
2. 攻击者可以通过省略源代码中的自检代码行或绕过从存储库下载的二进制文件来绕过自检。

### 3. 操纵监控结果

攻击者可以通过合法的API（GetServers()）从管理服务器下载监控任务列表，然后：

1. 测量任务列表中每个时间服务器的时间并计算偏移量。
2. 通过SubmitResults() API上报目标时间服务器的状态。

攻击者可以通过报告虚假的偏移值来故意降低目标时间服务器的分数。方法包括：

- **调整本地时钟**：将错误的本地时钟应用于所有正常工作的时间服务器的NTP结果中。
- **直接操作代码**：在监控报告过程中，通过修改代码将任意值写入偏移字段，无需实际进行NTP测量。

通过调整本地时钟或直接修改监控报告中的偏移值，攻击者可以降低目标时间服务器的分数，精准地排除特定区域的时间服务器，使其变为非活动状态。

### 4. 少量监控服务器的影响

注入的监控服务器影响力与注册的合法监控服务器数量成反比。

由于评分算法的敏感性，分数下降快但恢复慢，这给了少量恶意监控服务器巨大的攻击力量。攻击者的监控服务器相当于五个合法服务器。具体特性如下：

- **评分算法的老化率**：当分数在20到0之间时，总是负面影响。
- **覆盖范围**：即使注入的监控服务器不到监控服务器池的20%，也能对目标时间服务器产生重大影响。

这种攻击技术上没有规模限制，只要有任务列表，一个注入的监控服务器可以覆盖池中的所有时间服务器。

# 7 Attack Analysis

## 7.1 Distorting the Vision of the Monitor

**攻击目标**：通过适应性延迟攻击，使NTP池中的目标时间服务器的延迟达到500毫秒。

**攻击步骤**：

1. 在目标时间服务器上添加随机延迟。
2. 攻击者嗅探目标时间服务器和监控服务器之间的数据包。
3. 攻击者每30秒从管理服务器获取监控日志，计算并调整延迟。
4. 重复调整，确保延迟保持在500毫秒左右。

**结果**：实验显示，攻击者成功使目标时间服务器的平均偏移达到245.6毫秒，使其评分迅速下降并最终进入灰色区域（非活跃状态）。

## 7.2 Implications of a Faulty Single Monitor

## 7.3 Injecting a Few Monitors is Enough

## 7.4 Flying under the Radar

# 8 Mitigation

## 8.1 Securing the Monitor’s Operations

## 8.2 Resilience against Injected Monitors

## 8.3 Towards Better Security for the NTP Pool
